{% extends "base.html" %}

{% block title %}Compose Email Campaign{% endblock %}

{% block styles %}
<style>
    #email-body-editor {
        min-height: 300px;
        border: 1px solid #e5e7eb;
        border-radius: 0.375rem;
        padding: 0.75rem;
        overflow-y: auto;
    }
    #email-body-editor:focus {
        outline: none;
        border-color: #2d6a4f;
        box-shadow: 0 0 0 3px rgba(45, 106, 79, 0.1);
    }
    .rich-text-btn {
        padding: 0.25rem 0.5rem;
        background-color: #f3f4f6;
        border: 1px solid #e5e7eb;
        border-radius: 0.25rem;
        margin-right: 0.25rem;
        cursor: pointer;
    }
    .rich-text-btn:hover {
        background-color: #e5e7eb;
    }
    .recipient-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.5rem;
        border-bottom: 1px solid #e5e7eb;
    }
    .recipient-item:last-child {
        border-bottom: none;
    }
    .remove-recipient {
        color: #ef4444;
        cursor: pointer;
    }
    .remove-recipient:hover {
        color: #b91c1c;
    }
</style>
{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-6">
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-2xl font-bold text-gray-800">
            Compose Email Campaign
        </h1>
        <a href="{{ url_for('main.dashboard') }}" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 transition duration-150">
            <i class="fas fa-times mr-1"></i> Cancel
        </a>
    </div>
    
    <div class="bg-white shadow-md rounded-lg p-6">
        <div class="mb-4">
            <div class="flex justify-between items-center">
                <h2 class="text-lg font-medium text-gray-900">
                    Recipients (<span id="recipient-count">{{ contacts|length }}</span>)
                </h2>
                <button id="toggle-recipients" class="text-sm text-forest-green hover:text-forest-green-dark">
                    Hide Recipients
                </button>
            </div>
            <ul id="recipient-list" class="mt-2 max-h-48 overflow-y-auto border border-gray-200 rounded-md">
                {% for contact in contacts %}
                <li class="recipient-item" data-contact-id="{{ contact.id }}">
                    <div>
                        <span class="font-medium">{{ contact.name }}</span>
                        <span class="text-gray-500 ml-2">{{ contact.email }}</span>
                    </div>
                    <button class="remove-recipient" data-contact-id="{{ contact.id }}">
                        <i class="fas fa-times"></i>
                    </button>
                </li>
                {% endfor %}
            </ul>
        </div>
        
        <form method="POST" action="{{ url_for('email_campaigns.compose') }}">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <input type="hidden" name="contact_ids" id="contact_ids" value="{{ contacts|map(attribute='id')|list|tojson }}">
            
            {% if error %}
            <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4" role="alert">
                <span class="block sm:inline">{{ error }}</span>
            </div>
            {% endif %}
            
            <div class="mb-4">
                <label for="name" class="block text-sm font-medium text-gray-700 mb-1">Campaign Name</label>
                <input type="text" name="name" id="name" value="{{ name|default('') }}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-forest-green focus:border-forest-green" placeholder="e.g., Monthly Newsletter - June 2023" required>
            </div>
            
            <div class="mb-4">
                <label for="subject" class="block text-sm font-medium text-gray-700 mb-1">Email Subject</label>
                <input type="text" name="subject" id="subject" value="{{ subject|default('') }}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-forest-green focus:border-forest-green" placeholder="Enter email subject" required>
            </div>
            
            <div class="mb-4">
                <label for="body" class="block text-sm font-medium text-gray-700 mb-1">Email Body</label>
                <div id="rich-text-controls" class="mb-2">
                    <button type="button" class="rich-text-btn bold-btn" title="Bold">
                        <i class="fas fa-bold"></i>
                    </button>
                    <button type="button" class="rich-text-btn italic-btn" title="Italic">
                        <i class="fas fa-italic"></i>
                    </button>
                    <button type="button" class="rich-text-btn underline-btn" title="Underline">
                        <i class="fas fa-underline"></i>
                    </button>
                    <button type="button" class="rich-text-btn link-btn" title="Insert Link">
                        <i class="fas fa-link"></i>
                    </button>
                </div>
                <div id="email-body-editor" class="mb-2">{{ body|default('')|safe }}</div>
                <input type="hidden" name="body" id="body" value="{{ body|default('') }}">
                <p class="text-xs text-gray-500">
                    You can use <code>{{name}}</code> to personalize the email with the recipient's name.
                </p>
            </div>
            
            <div class="flex justify-end">
                <button type="submit" class="px-4 py-2 bg-forest-green text-white rounded-md hover:bg-forest-green-dark transition duration-150">
                    Continue to Review
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block scripts %}
<!-- Load modular JavaScript files -->
<script type="module" src="{{ url_for('static', filename='js/main.js') }}"></script>
{% endblock %} 